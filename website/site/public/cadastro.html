<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro</title>
    <link rel="stylesheet" href="css/cadastro.css" />
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;0,800;0,900;1,400;1,500;1,600;1,700;1,800;1,900&family=Quicksand:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  </head>
  <body>
    <div class="header">
      <div class="container">
        <a href="" target="blank"
          ><img src="img/logo.svg" alt="logo travel.me" style="width: 50"
        /></a>
        <div class="navbar">
          <ul>
            <li><a href="index.html">Página inicial</a></li>
            <li><a href="index.html#tituloHistoria">Sobre mim</a></li>
            <li><a href="">Contato</a></li>
          </ul>
        </div>
        <div class="botoes">
          <button class="botao1" onclick="cadastrar()">Cadastrar-se</button>

          <button class="botao2" onclick="entrar()">Entrar</button>
       
        </div>
        <div class="alerta_erro">
          <div class="card_erro" id="cardErro">
            <span id="mensagem_erro"></span>
          </div>
        </div>
      </div>
    </div>
    <!-- <div class="background"> -->
    <div class="containerBox">
      <div class="box-meio">
        <h2 class="tituloCadastro">Cadastrar-se</h2>

        <div class="box">
          <div class="cadastro">
            <div id="direito" class="lado-direito">
              <div class="lados">
                <div class="lado1_direito">
                  <p>Nome:</p>
                  <input type="text" id="iptNome" required />
                  <p>Telefone:</p>
                  <input type="text" id="iptTelefone" required />
                  <p>CPF:</p>
                  <input type="text" id="iptCpf" required />
                  <div
                  class="mensagemErro"
                  id="erroCpf"
                  style="display: none"
                >
                  Cpf inválido <br />
                </div>
                </div>
                <div class="lado2_direito">
                  <p>Email:</p>
                  <input type="text" id="iptEmail" required />
                  <div
                    class="mensagemErro"
                    id="erroEmail"
                    style="display: none"
                  >
                    E-mail inválido <br />
                  </div>
                  <p>Senha:</p>
                  <input type="password" id="iptSenha" required />
                  <ul class="mensagemErro" id="erroSenha" style="display: none">
                    <li>Insira uma senha com pelo menos 8 dígitos</li>
                    <li>A senha deve ter pelo menos 1 caractere especial</li>
                    <li>A senha deve ter pelo menos uma letra maiúscula</li>
                    <li>A senha deve ter pelo menos uma letra minúscula</li>
                  </ul>
                  <p>Confirme a senha:</p>
                  <input type="password" id="id_confirmacao" required />
                  <div
                    class="mensagemErro"
                    id="erroValidacao"
                    style="display: none"
                  >
                    Senhas não coincidem
                  </div>
                </div>
              </div>
            <!-- <p style="color: white" id="mensagemErro"></p> -->
          </div>
          <div id="esquerdo" class="lado-esquerdo">
            <div class="lados">
            <div class="lado1_esquerdo">
              <p>CEP:</p>
              <input type="text" id="iptCep" required />
              <div class="mensagemErro" id="erroCEP" style="display: none">
                CEP inválido
              </div>
              <p>UF:</p>
              <input type="text" id="iptUF" required />
              <p>Cidade:</p>
              <input type="text" id="iptCidade" required />
            </div>
            <div class="lado2_esquerdo">
              <p>Bairro:</p>
              <input type="text" id="iptBairro" required />
              <p>Rua:</p>
              <input type="text" id="iptRua" required />
              <p>Complemento:</p>
              <input type="text" id="iptComplemento"  required/>
            </div>
        </div>
        </div>
        <div class="div-botao" id="divBotao">
          <button id="botaoVoltar" style="display: none" onclick="voltar()">
            Voltar
          </button>
          <button id="passoUm" onclick="passo1Cadastro()">Avançar</button>
          <button id="cadastrarse" onclick="cadastrar()">Cadastrar</button>
        </div>
        </div>
      </fieldset>
    </div>
    </div>
    </div>
  </body>
</html>
<script>
  function passo1Cadastro() {
    var email = iptEmail.value;
    var senha = iptSenha.value;
    var nome = iptNome.value;
    var telefone = iptTelefone.value;
    var confirmacao = id_confirmacao.value;
    var cpf = iptCpf.value;

    var possui_especial =
      senha.indexOf("#") >= 0 ||
      senha.indexOf("@") >= 0 ||
      senha.indexOf("!") >= 0 ||
      senha.indexOf("%") >= 0 ||
      senha.indexOf("?") >= 0 ||
      senha.indexOf("-") >= 0 ||
      senha.indexOf("+") >= 0 ||
      senha.indexOf("_") >= 0;

    if (
      email.indexOf("@") >= 0 &&
      (email.endsWith(".com") ||
        email.endsWith(".br") ||
        email.endsWith(".school"))
    ) {
      erroEmail.style.display = "none";
    } else {
      erroEmail.style.display = "block";
      iptEmail.style.borderColor = "red";
    }

    if (
      senha.length >= 8 &&
      possui_especial &&
      senha != senha.toUpperCase() &&
      senha != senha.toLowerCase()
    ) {
      erroSenha.style.display = "none";
    } else {
      erroSenha.style.display = "block";
      iptSenha.style.borderColor = "red";
    }
    if(cpf.length > 11){
      erroCpf.style.display = "none";

    }else{
      erroCpf.style.display = "block";
      iptCpf.style.borderColor = "red";
    }


    if (senha == confirmacao) {
      erroValidacao.style.display = "none";
    } else {
      erroValidacao.style.display = "block";
      id_confirmacao.style.borderColor = "red";
    }

    if (
      email.indexOf("@") >= 0 &&
      (email.endsWith(".com") ||
        email.endsWith(".br") ||
        email.endsWith(".school")) &&
      senha.length >= 8 &&
      possui_especial &&
      senha != senha.toUpperCase() &&
      senha != senha.toLowerCase() &&
      senha == confirmacao
    ) {
      direito.style.display = "none";
      esquerdo.style.display = "block";
      passoUm.style.display = "none";
      cadastrarse.style.display = "block";
      botaoVoltar.style.display = "block";
      divBotao.style.flexDirection = "row";


    }

    fetch("/usuarios/passo1Cadastro", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        cpfServer: cpf,
        emailServer: email,
        senhaServer: senha,
        nomeServer: nome,
        telefoneServer: telefone

      }),
    })
    .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          cardErro.style.display = "block";

          mensagem_erro.innerHTML =
            "Primeira etapa realizada com sucesso! Redirecionando para próxima etapa...";

        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    
  }
    function cadastrar() {
    
    var cep = iptCep.value;
    var unidadeFederativa = iptUF.value;
    var cidade = iptCidade.value;
    var bairro = iptBairro.value;
    var rua = iptRua.value;
    var complemento = iptComplemento.value;

    if (cep.length == 8) {
      erroCEP.style.display = "none";
    } else {
      erroCEP.style.display = "block";
      iptCep.style.borderColor = "red";
    }
    // Enviando o valor da nova input
    fetch("/usuarios/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        cepServer: cep,
        unidadeFederativaServer:unidadeFederativa,
        cidadeServer: cidade,
        bairroServer:bairro,
        ruaServer:rua,
        complementoServer: complemento


      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
          cardErro.style.display = "block";

          mensagem_erro.innerHTML =
            "Cadastro realizado com sucesso! Redirecionando para tela de Login...";

          setTimeout(() => {
            window.location = "login.html";
          }, "2000");
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
  }

  function voltar() {
    direito.style.display = "block";
    esquerdo.style.display = "none";
    passoUm.style.display = "block";
    cadastrarse.style.display = "none";
    botaoVoltar.style.display = "none";
    divBotao.style.flexDirection = "column";

  }
</script>
